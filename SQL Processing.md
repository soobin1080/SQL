# SQL 처리과정

### 1. SQL Parsing
  - 파싱 종류
    1) 소프트 파싱 : SQL 커서를 메모리에서 바로 찾아 실행 단계로 넘김
    2) 하드 파싱 : SQL 커서를 찾는데 실패하여 최적화 및 Row-Source 생성 단계를 거치는 것
  - SQL Parser : 사용자가 던진 SQL을 가장 먼저 받아서 처리하는 엔진
  - Parsing 순서
    1) 개별 구성요소를 분석하고 파싱(tokenize)해서 파싱 트리를 구성
      - 문법적 오류 **Syntax 체크** : 순서, 누락키워드, 사용불가 키워드
    2) 의미상 오류 확인하는 **Semantic 체크**
    3) 문법적 오류가 없고, 의미상 오류가 없으면 해싱 알고리즘을 통해 SQL 커서가 Shared Pool에 캐싱 되어있는지 확인
      - SQL ASCII 텍스트에 대한 숫자 값을 계산한 후, 해시 값으로 변환하여 캐싱 확인
##### Shared Pool에서 찾은 SQL 문장과 수행하려는 SQL문이 100% 일치하더라도 파싱을 요청한 사용자가 다르거나 옵티마이저 관련 파리미터 설정이 다르다면 새로운 SQL 캐시 생성

### 2. Optimization (SQL 최적화)
  - Optimizer : 시스템 통계 및 오브젝트 통계 정보를 판단기준으로 삼아 다양한 엑세스 경로를 비교하여 가장 효율적인 **실행 계획**을 선택해주는 DBMS의 **핵심 엔진**
  - 옵티마이저 최적화 수행 시 사용하는 서브 엔진 3개
    1) Query Transformer - 최적화하기 쉬운 형태로 변환을 시도
    2) Plan Generator - 후보 군이 될만한 실행계획들을 생성하는 역할
    3) Estimator - 쿼리 오퍼레이션 각 단계의 선택도, 카디널리티, 비용 등을 계산하여 실행계획 전체에 대한 총 비용을 계산
       - 각 단계 수행에 필요한 I/O, CPU, 메모리 사용량 등을 예측하기 위해 DB 오브젝트(테이블, 인덱스 등) 통계 정보와
         하드웨어적인 시스템 성능 통계정보(CPU 속도, Single Block Read Time, Multiblock Read Time 등)을 이용
       - 오브젝트 통계 정보와 시스템 통계 정보는 오라클이 자동으로 수집 또는 DB 관리자의 정책에 따라 주기적으로 수집
   
##### 현실적으로 모든 실행계획을 평가하는 것은 불가능하므로 최적화에 걸리는 **총 소요시간**을 단축시키는 목적으로 오라클이 사용하는 지능적인 테크닉 2가지
1) **적응적 탐색 전략(Adaptive Search Strategy)** : 쿼리 수행 시 예상되는 총 수행시간에 비해 쿼리 최적화에 걸리는 시간이 일정비율을 넘지 않도록 함.
2) **Mutiple Initial Orderings Heuristic** : 최적의 실행계획을 발견할 가능성이 높은 순서대로 비용 평가, 실행계획 평가 도중에 멈추더라도 최적일 확률을 높임
     
### 3. Row-Source Genertaion
  - 옵티마이저 최적화 과정을 거치며 만들어진 실행 계획을 실행 가능한 코드 또는 프로시저 형태로 포맷팅하는 작업을 Row-Source Generator가 담당
  - Row-Source 는 레코드 집합을 반복처리하면서 사용자가 요구한 최종 결과집합을 생성하는데 사용되는 제어 구조

##### DB 에서 이루어지는 처리과정은 대부분 I/O 작업에 집중되는 반면, 하드 파싱은 CPU를 많이 소비하는 몇 안되는 작업 중 하나
  - 하드 파싱
    - 하드 파싱 과정에서 Shared Pool 과 라이브러리 캐시에 대해 발생하는 래치 경합도 CPU를 많이 소비하는 요인
    - 한번 수행 시 많은 데이터 딕셔너리 조회를 수반
##### 파싱 과정을 거친 SQL 커서를 재사용할 수 있도록 캐싱해주는 메모리 공간이 바로 라이브러리 캐시이다.

### 4. Execution

